name: Update GitHub Stats

on:
  schedule:
    - cron: '0 */12 * * *'
  workflow_dispatch:  
  push:
    branches: [ main ]

permissions:
  contents: write 

jobs:
  update-stats:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        persist-credentials: true  

    - name: Download GitHub Stats
      run: |
        
        mkdir -p assets
        
        
        curl -s -o assets/stats.svg "https://github-readme-stats.vercel.app/api?username=JavadTorabiKh&show_icons=true&theme=dark&hide_border=true&count_private=true&include_all_commits=true"
        
        
        curl -s -o assets/streak.svg "https://github-readme-streak-stats.herokuapp.com/?user=JavadTorabiKh&theme=radical"
        
        
        if [ ! -s assets/stats.svg ]; then
          echo "Failed to download stats.svg"
          exit 0  
        fi
        
        if [ ! -s assets/streak.svg ]; then
          echo "Failed to download streak.svg"
          exit 0  
        fi

    - name: Commit and Push if changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add assets/
        
        
        if git diff-index --quiet HEAD --; then
          echo "No changes to commit"
        else
          git commit -m "ðŸ“Š Auto-update GitHub stats - $(date +'%Y-%m-%d %H:%M:%S')"
          git push
        fi
