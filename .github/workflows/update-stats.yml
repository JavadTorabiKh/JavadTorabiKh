name: Update GitHub Stats

on:
  schedule:
    # Ù‡Ø± 12 Ø³Ø§Ø¹Øª Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
    - cron: '0 */12 * * *'
  workflow_dispatch:  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ
  push:
    branches: [ main ]

permissions:
  contents: write  # Ø§ÛŒÙ† Ø®Ø· Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡

jobs:
  update-stats:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        persist-credentials: true  # Ø§ÛŒÙ† Ø®Ø· Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡

    - name: Download GitHub Stats
      run: |
        # Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ assets Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
        mkdir -p assets
        
        # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¢Ù…Ø§Ø± GitHub
        curl -s -o assets/stats.svg "https://github-readme-stats.vercel.app/api?username=JavadTorabiKh&show_icons=true&theme=radical&include_all_commits=true"
        
        # Ø¯Ø§Ù†Ù„ÙˆØ¯ Streak Stats
        curl -s -o assets/streak.svg "https://github-readme-streak-stats.herokuapp.com/?user=JavadTorabiKh&theme=radical"
        
        # Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯Ù† Ø¯Ø§Ù†Ù„ÙˆØ¯
        if [ ! -s assets/stats.svg ]; then
          echo "Failed to download stats.svg"
          exit 0  # Ø®Ø·Ø§ Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±
        fi
        
        if [ ! -s assets/streak.svg ]; then
          echo "Failed to download streak.svg"
          exit 0  # Ø®Ø·Ø§ Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ø¨Ú¯ÛŒØ±
        fi

    - name: Commit and Push if changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add assets/
        
        # Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª
        if git diff-index --quiet HEAD --; then
          echo "No changes to commit"
        else
          git commit -m "ğŸ“Š Auto-update GitHub stats - $(date +'%Y-%m-%d %H:%M:%S')"
          git push
        fi